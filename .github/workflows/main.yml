name: Fix Project Structure
on: [workflow_dispatch, push]

jobs:
  repair:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install Flutter Manually
        run: |
          git clone https://github.com/flutter/flutter.git -b stable $HOME/flutter
          echo "$HOME/flutter/bin" >> $GITHUB_PATH

      - name: Repair and Force Create
        run: |
          export PATH="$PATH:$HOME/flutter/bin"
          # Ин фармон файлҳои Gradle ва сохтори Android-ро аз нав месозад
          flutter create . --overwrite --project-name=my_app
          
          # Тафтиш мекунем, ки оё файлҳои муҳим сохта шуданд
          ls -la android/

      - name: Push Fixed Files to GitHub
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add android/ ios/ web/ .metadata pubspec.yaml
          git commit -m "Fix: Added missing Gradle wrappers and Flutter structure" || echo "No changes"
          git push
